<dom-module id="ha-themed-slider"assetpath=""><template><style>.disable-off-when-min{--paper-slider-pin-start-color:var(--paper-slider-pin-color)}.disable-off-when-min.is-on{--paper-slider-knob-start-color:var(--paper-slider-knob-color);--paper-slider-knob-start-border-color:var(--paper-slider-knob-color)}paper-slider{margin:4px 0;max-width:100%;min-width:100px;width:var(--ha-paper-slider-width,200px)}</style><paper-slider min="[[_themedMin]]"max="[[_computeAttribute(theme, &quot;max&quot;, max)]]"pin="[[_computeAttribute(theme, &quot;pin&quot;, pin)]]"class$="[[computeClass(theme, isOn, _themedMin)]]"value="[[value]]"on-change="valueChanged"></paper-slider></template></dom-module><script>Polymer({is:"ha-themed-slider",ready:function(){this.value=this.value+1,this.value=this.value-1,this.disableOffWhenMin=!this._computeAttribute(this.theme,"off_when_min",!this.disableOffWhenMin),this.computeEnabledThemedReportWhenNotChanged(this.theme,this.disableReportWhenNotChanged)},properties:{min:{type:Number,value:0},max:{type:Number,value:100},pin:{type:Boolean,value:!1},isOn:{type:Boolean,value:!1},disableOffWhenMin:{type:Boolean,value:!1,notify:!0},disableReportWhenNotChanged:{type:Boolean,value:!1},theme:{type:Object},value:{type:Number,notify:!0},_themedMin:{type:Number,computed:'_computeAttribute(theme, "min", min)'}},observers:["computeEnabledThemedReportWhenNotChanged(theme, disableReportWhenNotChanged)"],computeEnabledThemedReportWhenNotChanged:function(e,t){this._enabledThemedReportWhenNotChanged=this._computeAttribute(e,"report_when_not_changed",!t)},_computeAttribute:function(e,t,n){return e&&t in e?e[t]:n},computeClass:function(e,t,n){var i="";return t&&(i+="is-on "),this._computeAttribute(e,"off_when_min",!this.disableOffWhenMin)||0===n?"":i+"disable-off-when-min"},valueChanged:function(e){if(!this._enabledThemedReportWhenNotChanged&&this.value===e.target.value)return void e.stopPropagation();this.value=e.target.value}})</script><script>Polymer({is:"dynamic-element",properties:{hass:{type:Object},stateObj:{type:Object},elementName:{type:String},inDialog:{type:Boolean,value:!1}},observers:["observerFunc(hass, stateObj, elementName, inDialog)"],observerFunc:function(e,t,s,a){window.hassUtil.dynamicContentUpdater(this,s.toUpperCase(),{hass:e,stateObj:t,inDialog:a})}})</script><dom-module id="dynamic-with-extra"assetpath=""><template><style is="custom-style"include="iron-flex iron-flex-alignment iron-flex-factors"></style><style>:host{display:inline-block}dynamic-element{margin-left:16px}ha-state-label-badge{margin-left:8px}.extra{margin-bottom:-16px;--ha-label-badge-size:36px;--ha-label-badge-font-size:1.2em}</style><div class$="[[extraClass(extraObj)]] horizontal layout"><template is="dom-if"if="[[extraObjVisible]]"><ha-state-label-badge hass="[[hass]]"state="[[extraObj]]"></ha-state-label-badge></template><template is="dom-if"if="[[_showControl(inDialog, stateObj)]]"><dynamic-element class="flex"state-obj="[[stateObj]]"hass="[[hass]]"element-name="[[controlElement]]"></dynamic-element></template></div></template></dom-module><script>Polymer({is:"dynamic-with-extra",properties:{hass:{type:Object},inDialog:{type:Boolean,value:!1},stateObj:{type:Object},controlElement:{type:String},extraObj:{type:Object,computed:"computeExtra(hass, stateObj, inDialog)"},extraObjVisible:{type:Boolean,computed:"computeExtraVisible(hass, stateObj, inDialog)"}},_getObject:function(t,e){if(!e.attributes.extra_badge)return null;var r=e.attributes.extra_badge;return r.entity_id&&t.states[r.entity_id]?Object.assign({},t.states[r.entity_id]):r.attribute&&e.attributes[r.attribute]?{state:e.attributes[r.attribute],_domain:"none",entity_id:null,attributes:{unit_of_measurement:r.unit}}:null},computeExtra:function(t,e){var r=this._getObject(t,e);return r?(r._entityDisplay="",r):null},computeExtraVisible:function(t,e,r){if(r)return!1;var i=this._getObject(t,e);if(!i)return!1;var a=e.attributes.extra_badge.blacklist_states;return!a||(Array.isArray(a)||(a=[a]),!a.some(function(t){return RegExp(t).test(i.state.toString())}))},extraClass:function(t){return t?"extra":""},_showControl:function(t,e){return!!t||!e.attributes.hide_control}})</script><dom-module id="state-card-with-slider"assetpath="./"><template><style is="custom-style"include="iron-flex iron-flex-alignment iron-flex-factors"></style><style>.second-line,.state-and-toggle,.state-info{max-width:100%}.nowrap .state-and-toggle{overflow:hidden;flex-grow:0}.nowrap .second-line{overflow:hidden}.second-line{padding-top:20px;padding-bottom:16px;margin-top:-20px;margin-bottom:-16px}.stretch .second-line,.stretch ha-themed-slider{width:100%;--ha-paper-slider-width:100%}.nowrap .state-info{min-width:initial}.top-wrapper,ha-themed-slider{min-width:100px;max-width:100%}.top-wrapper.stretch{display:block}</style><div id="container"class$="horizontal layout flex top-wrapper [[_computeWrapClass(mode, stretchSlider, lineTooLong, inDialog)]]"><div class="horizontal layout justified flex-auto state-and-toggle"><state-info class="state-info"state-obj="[[stateObj]]"in-dialog="[[showLastChanged(stateObj, inDialog)]]"secondary-line$="[[extra]]"><template is="dom-if"if="[[extra]]"><span>[[extra]]</span></template></state-info><template is="dom-if"if="[[breakSlider]]"><dynamic-with-extra hass="[[hass]]"state-obj="[[stateObj]]"control-element="[[controlElement]]"in-dialog="[[inDialog]]"></dynamic-with-extra></template></div><template is="dom-if"if="[[showSlider]]"><div class="horizontal layout flex-auto end-justified second-line"><ha-themed-slider id="slider"max="[[max]]"min="[[min]]"theme="[[stateObj.attributes.slider_theme]]"is-on="[[isOn(stateObj, nameOn)]]"value="{{sliderValue}}"disable-off-when-min="{{disableOffWhenMin}}"on-change="sliderChanged"on-tap="stopPropagation"></ha-themed-slider><template is="dom-if"if="[[!breakSlider]]"><dynamic-with-extra hass="[[hass]]"state-obj="[[stateObj]]"control-element="[[controlElement]]"in-dialog="[[inDialog]]"></dynamic-with-extra></template></div></template></div></template></dom-module><script>var SUPPORTED_MODES=["single-line","break-slider","break-slider-toggle","hide-slider","no-slider"],DEFAULT_MODE="break-slider-toggle";Polymer({is:"state-card-with-slider",attached:function(){this.async(function(){this.readyToCompute=!0,this._onIronResize()}.bind(this),1)},behaviors:[Polymer.IronResizableBehavior],properties:{hass:{type:Object},inDialog:{type:Boolean,value:!1},stateObj:{type:Object},controlElement:{type:String},domain:{type:String},serviceMin:{type:String},serviceMax:{type:String},valueName:{type:String},setValueName:{type:String},nameOn:{type:String,value:"on"},min:{type:Number,value:0},max:{type:Number,value:255},sliderValue:{type:Number,value:0},disableOffWhenMin:{type:Boolean},mode:{type:String},stretchSlider:{type:Boolean,value:!1},breakSlider:{type:Boolean,value:!1},hideSlider:{type:Boolean,value:!1},lineTooLong:{type:Boolean,value:!1},minLineBreak:{type:Number,value:0},maxLineBreak:{type:Number,value:999},showSlider:{type:Number,computed:"_showSlider(inDialog, stateObj, hideSlider)"},extra:{type:String,computed:"computeExtra(stateObj)"}},observers:["stateObjChanged(stateObj, nameOn, valueName)"],listeners:{"iron-resize":"_onIronResize"},_onIronResize:function(){if(this.readyToCompute){if("no-slider"===this.mode)return this.hideSlider=!0,void(this.breakSlider=!0);var e=this.breakSlider;this.lineTooLong=!1,this.hideSlider=!1,this.breakSlider=!1;var t=this.$.container,i=t.clientWidth;if(i<=this.minLineBreak)this.lineTooLong=!0;else if(i>=this.maxLineBreak)this.lineTooLong=!1;else{var r=t.clientHeight,a=this.$$(".state-info").clientHeight;this.lineTooLong=r>1.5*a,this.lineTooLong?this.minLineBreak=i:e||(this.maxLineBreak=i)}this.hideSlider="hide-slider"===this.mode&&this.lineTooLong,this.breakSlider=("break-slider"===this.mode||"hide-slider"===this.mode)&&this.lineTooLong,this.showSlider||(this.breakSlider=!0)}},_computeWrapClass:function(e,t,i,r){return r?"":"single-line"===e?"nowrap":t&&i?"stretch wrap":"wrap"},_showSlider:function(e,t,i){return!e&&!i&&1&t.attributes.supported_features},sliderChanged:function(e){var t=parseInt(e.target.value,10),i={entity_id:this.stateObj.entity_id};if(!isNaN(t)){var r=this.$$("#slider");e.target!==r?r=e.target:e.path?r=e.path[0]:e.composedPath&&(r=e.composedPath()[0]),0===t||t<=r.min&&!this.disableOffWhenMin?this.hass.callService(this.domain,this.serviceMin,i):(i[this.setValueName||this.valueName]=t,this.hass.callService(this.domain,this.serviceMax,i))}},stateObjChanged:function(e,t,i){this.isOn(e,t)?this.sliderValue=e.attributes[i]:this.sliderValue=0,e&&(-1!==SUPPORTED_MODES.indexOf(e.attributes.state_card_mode)?this.mode=e.attributes.state_card_mode:this.mode=DEFAULT_MODE,e.attributes.stretch_slider&&(this.stretchSlider=!0))},isOn:function(e,t){return e&&e.state===t},stopPropagation:function(e){e.stopPropagation()},computeExtra:function(e){if(e.attributes.extra_data_template){var t=!1,i=e.attributes.extra_data_template.replace(/{([^}!]+)(!=)?([^}]+)?}/g,function(i,r,a,s){return!e.attributes[r]||a&&new RegExp(s).test(e.attributes[r])?(t=!0,""):e.attributes[r]});return t?null:i}return null},showLastChanged:function(e,t){return!!t||!!e.attributes.show_last_changed}})</script><script>Polymer({is:"state-card-custom-ui",attached:function(){this.hass&&this.stateObj&&void 0!==this._context&&(this._context=void 0,this.inputChanged(this.hass,this.inDialog,this.stateObj))},properties:{hass:{type:Object},inDialog:{type:Boolean,value:!1},stateObj:{type:Object}},observers:["inputChanged(hass, inDialog, stateObj)"],_getContext:function(){if(void 0===this._context){this._context=[];for(var t=this;t;t=t.domHost)switch(t.tagName){case"HA-ENTITIES-CARD":t.groupEntity?this._context.push(t.groupEntity.entity_id):!1===t.groupEntity&&t.states&&t.states.length&&this._context.push("group."+window.hassUtil.computeDomain(t.states[0]));break;case"MORE-INFO-GROUP":t.stateObj&&this._context.push(t.stateObj.entity_id);break;case"PARTIAL-CARDS":this._context.push(t.currentView?t.currentView:"default_view")}}return this._context},_maybeChangeName:function(t,e,i){if(e)return t;var s=this._getContext();if(!s)return t;if(i&&t.attributes.hidden_in&&t.attributes.hidden_in.filter(function(t){return-1!==s.indexOf(t)}))return null;if(!t.attributes.friendly_names)return t;var a;return s.forEach(function(e){a||t.attributes.friendly_names[e]&&(a=t.attributes.friendly_names[e])}),a?{entity_id:t.entity_id,_entityDisplay:a,state:t.state,attributes:t.attributes,last_changed:t.last_changed}:t},badgeMode:function(t,e){var i=[];e.attributes.entity_id.forEach(function(s){var a=t.states[s];(!e.attributes.badges_list||e.attributes.badges_list.indexOf(a.entity_id)>=0)&&i.push(this._maybeChangeName(a,!1,!1))}.bind(this)),window.hassUtil.dynamicContentUpdater(this,"HA-BADGES-CARD",{hass:t,states:i}),Polymer.dom(this).lastChild.style.setProperty("--ha-label-margin-bottom","0")},inputChanged:function(t,e,i){var s,a;if(i&&t){if(a=window.hassUtil.computeDomain(i),!e&&"group"===a&&"badges"===i.attributes.state_card_mode)return void this.badgeMode(t,i);var n=this._maybeChangeName(i,e,!0);if(!n){var r=Polymer.dom(this);return r.lastChild&&r.removeChild(r.lastChild),void(r.parentNode&&r.parentNode.parentElement&&(r.parentNode.parentElement.style.margin="0",r.parentNode.parentElement.style.padding="0"))}var o={hass:t,stateObj:n,inDialog:e};a=window.hassUtil.computeDomain(i),s=window.hassUtil.stateCardType(t,i),"light"!==a&&"cover"!==a||(s="with-slider",Object.assign(o,{domain:a})),"light"===a&&Object.assign(o,{controlElement:"ha-entity-toggle",serviceMin:"turn_off",serviceMax:"turn_on",valueName:"brightness"}),"cover"===a&&Object.assign(o,{controlElement:"ha-cover-controls",max:100,serviceMin:"close_cover",serviceMax:"set_cover_position",setValueName:"position",valueName:"current_position",nameOn:"open"}),window.hassUtil.dynamicContentUpdater(this,"STATE-CARD-"+s.toUpperCase(),o)}}})</script>